ARG VERSION_BACK=${VERSION_BACK}

FROM node:${VERSION_BACK} AS base

RUN apk add curl

################################################################################
################################################################################
#							DEV BUILD
################################################################################
################################################################################
FROM base AS development

ENV NODE_ENV="development"

USER node
WORKDIR /srv/app

CMD npm i && npm run start:dev


################################################################################
################################################################################
#							PROD BUILD
################################################################################
################################################################################
FROM base AS production

ENV NODE_ENV="production"

COPY ./backend /srv/app

RUN chown -R node:node /srv/app

USER node
WORKDIR /srv/app

RUN npm i

CMD npm run start:prod
